import{R as J}from"./Report.99ffdd4b.js";import{u as P,S as $,d as q}from"./index.ad6f86f2.js";import"./vue3-datepicker.8db1d195.js";import{a as H}from"./axios.3fa379ca.js";import"./xlsx-js-style.0235676d.js";import"./exceljs.4eeb6046.js";import"./clusterize.js.78919985.js";import"./uikit.bf3afdb6.js";import"./file-saver.55724082.js";import"./numfmt.50579c65.js";import"./hyperformula.40eff455.js";import{r as y,q as z,c as M,o as Q,A as U,j as G,H as K,h as L,i as X,y as W}from"./vendor.7b6f695f.js";import"./SpreadSheet.5622495f.js";import"./vuex.df26a1fd.js";import"./@babel/core.ed44cf94.js";import"./@vueform/multiselect.69d395cc.js";import"./vue3-date-time-picker.9548981a.js";import"./vue-cookie-next.8cb9bd86.js";import"./luxon.1f9cfc03.js";import"./react-cookie.6c5c119f.js";const Y={class:"uk-container-expand ecm-center-inputs"},Z={class:"uk-width-expand uk-text-center"},ee=["onClick"],je={setup(te){const B=P(),N=y(!1),A=async(o,s,e)=>{const l=await H.post("/rpc/db/timecard/interim-json",{interim_id:s}).then(i=>i.data);window.interimJson=l;const f=e.getCell("B6"),b=l.claim.claim_id;f.value=b;const v=e.getCell("B7");v.value=l.claim.risk.policy.insured.name;const _=e.getCell("E6");_.value=l.claim.risk.contract.syndicate.name;const c=e.getCell("E7");c.value=l.date.slice(0,10);const C=e.getRow(9),n=e.getRow(10),m=i=>[i.date.slice(0,10),i.hours||null,i.subject,i.unbillable_hours||null,i.disbursement||null,i.mileage||null];let d=11;l.timecards.slice(1).forEach(i=>{const t=duplicateRow(C,d);if(m(i).forEach((a,r)=>{t.getCell(r+1).value=a}),d=d+1,i.message){const a=duplicateRow(n,d);a.getCell(2).value=i.message,d=d+1}});const p=l.timecards[0];m(p).forEach((i,t)=>{C.getCell(t+1).value=i}),n.getCell(2).value=p.message,p.messsage||(n.hidden=!0);const R=e.actualRowCount+(n.hidden?1:0),w=e.getRow(R);return w.getCell(2).value=l.hours,w.getCell(4).value=l.unbillable_hours,w.getCell(5).value=l.disbursement,w.getCell(6).value=l.mileage,e},D=(o,s)=>{const e=o.getRow(4),l=o.getRow(5),f=[];e.eachCell((t,a)=>{f[a]=Object.assign({},t.style)});const b=Object.assign({},l.getCell(1).style),v=Object.assign({},l.getCell(1).alignment);console.log("Align",v,"root:",l.getCell(1).alignment);const _=[];s&&s.rows.map(t=>{if(t[2]!=="interim"){const a=t[6],r=t[8],u=t[9]||0,h=t[7]?t[7].replace(/[\r\n]+$/,""):"";_.push({user:a,date:r,hours:u,note:h})}});let c=6;const C=(t,a)=>{const r=t.height;if(r<=409)return o.mergeCells(a,1,c,3),r;{c=c+1,t.height=409;const u=r-409,h=o.insertRow(c,[]);h.height=u,console.warn("Merge row",r,t,a),console.warn("Merge cells",a,c),C(h,a)}};let n=!0,m=80;const d=10.9,p=t=>{const a=t.getCell(1);if(!a.value){console.warn("No Cell Value",a);return}const r=a.value.toString(),u=r.length,h=r.match(/\r\n\r\n/g);h&&h.length;const k=r.match(/\r\n/g),O=k?k.length:0,T=u>m?u/m:1;let g=(Math.ceil(T)+O)*d;g>409?(g=g-g/4,console.warn("Big Height",g)):g>100&&(g=g-g/8),t.height=g>12?g:15};o.getCell("A2").value=s.rows[0][0],o.getCell("B2").value=s.rows[0][1],_.forEach((t,a)=>{if(n)n=!1,e.values=[t.user,t.date,t.hours],e.eachCell((r,u)=>{r.style=f[u]}),l.getCell(1).style=b,l.getCell(1).value=t.note,p(l);else{o.insertRow(c,[t.user,t.date,t.hours],"n").eachCell((h,k)=>{h.style=f[k]}),c=c+1;const u=o.insertRow(c,[t.note],"n");u.getCell(1).style=b,u.getCell(1).alignment=v,p(u),C(u,c),c=c+1}});const R=c,w="C"+(R-1)+")",i=o.getRow(R).getCell(3);i.value={formula:i.formula.replace(/C5\)/,w)}},F=async o=>{const s=await q("/report/interim/pdf-template.xlsx"),e=s.getWorksheet("Sheet1");await A(o,S.value.interim_id,s.getWorksheet("Activity Summary")),D(s.getWorksheet("PDF"),o);const l=50,f=10,b=n=>{const m=n.getCell(4);if(!m.value){console.warn("No Cell Value",m);return}const d=m.value.toString(),p=d.length,R=d.match(/\n/g),w=R?R.length:0,i=p>l?p/l:1,a=(Math.ceil(i)+w)*f;n.height=a>12?a:12};e.getRow(4);const v=[];o&&o.rows.map(n=>{n[2]!=="interim"&&v.push([n[6],n[8],n[9]||0,n[7]])}),e.getCell("B2").value=o.rows[0][0],e.getCell("D2").value=o.rows[0][1],window.testSheet=e,e.insertRows(5,v,"i"),e.spliceRows(4,1);for(let n=4;n<e.actualRowCount;n++){const m=e.getRow(n);b(m)}const _=e.actualRowCount,c="C"+(_-1)+")",C=e.getRow(e.actualRowCount).getCell(3);return C.value={formula:C.formula.replace(/C4\)/,c)},s};function E(o,s){N.value=void 0,s&&s(),o(),console.warn("Reporting on",S.value),H.post("/rpc/db/timecard/interim",S.value).then(e=>{F(e.data).then(l=>{j.value=l,s(),new $(e.data).spreadsheet("Timecard Interim",l)}),window.testRep=e.data}).catch(e=>{s(),N.value=e,s.value=!1})}let x,V;function I(o,s){x=o,V=s}z(()=>{console.log("Interim:",B.params.id,x),j.value||E(x,V)}),y();const j=y();M(()=>j.value?j.value.getWorksheet("US"):void 0),y(!1);const S=M(()=>({interim_id:parseInt(B.params.id)}));return(o,s)=>(Q(),U("div",Y,[G(J,{title:"Timecard Interim",workbook:j.value},{default:K(({toggle:e,toggleLoading:l})=>[L(X(I(e,l)),1),W("div",Z,[W("button",{onClick:f=>E(e,l),class:"uk-button uk-button-primary",type:"button"}," Run Report ",8,ee)])]),_:1},8,["workbook"])]))}};export{je as default};
